import requests

# --- REPLACE THESE VALUES WITH YOUR ACTUAL CREDENTIALS ---
CLIENT_ID = "your_google_client_id_here.apps.googleusercontent.com"
CLIENT_SECRET = "your_google_client_secret_here"
REFRESH_TOKEN = "your_google_refresh_token_here"

def test_gmail_credentials():
    print("--- Starting Gmail Credential Test ---")

    # Step 1: Exchange Refresh Token for an Access Token
    token_url = "https://oauth2.googleapis.com/token"
    token_data = {
        "client_id": CLIENT_ID,
        "client_secret": CLIENT_SECRET,
        "refresh_token": REFRESH_TOKEN,
        "grant_type": "refresh_token",
    }

    print("[1/2] Attempting to refresh Access Token...")
    token_res = requests.post(token_url, data=token_data)
    
    if token_res.status_code != 200:
        print(f"❌ FAILED: Could not refresh token.\nResponse: {token_res.text}")
        return

    access_token = token_res.json().get("access_token")
    print("✅ Success: Access Token generated.")

    # Step 2: Use Access Token to call Gmail API (get profile)
    print("[2/2] Attempting to fetch Gmail profile...")
    profile_url = "https://gmail.googleapis.com/gmail/v1/users/me/profile"
    headers = {"Authorization": f"Bearer {access_token}"}
    
    profile_res = requests.get(profile_url, headers=headers)

    if profile_res.status_code == 200:
        email = profile_res.json().get("emailAddress")
        print(f"✅ FINAL SUCCESS! Connected to account: {email}")
    else:
        print(f"❌ FAILED: Could not reach Gmail API.\nResponse: {profile_res.text}")

if __name__ == "__main__":
    test_gmail_credentials()